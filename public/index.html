<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Test - JS - Plugins - Modules</title>
  </head>
  <body>
    <div>
      <component-a outbound-event="NAMESPACE:FETCH">
        <span slot="content">Fetch Data</span>
      </component-a>
      <button id="fetchDirect">Invoke Data Fetching Method</button>
      <button id="update">Update Data</button>
      <button id="updateDirect">Invoke Data Updating Method</button>
    </div>
    <div>
      <pre id="target"></pre>
    </div>
    <!-- Import components. -->
    <script src="../dist/components/component-a/index.js"></script>
    <!-- Import modules. -->
    <script src="../dist/modules/module-a/api.js"></script>
    <script src="../dist/modules/module-a/adapter.js"></script>
    <script src="../dist/modules/module-a/index.js"></script>
    <script src="../dist/modules/module-b/api.js"></script>
    <script src="../dist/modules/module-b/adapter.js"></script>
    <script src="../dist/modules/module-b/index.js"></script>
    <script src="../dist/core/index.js"></script>
    <script charset="utf-8">
      window.addEventListener('DOMContentLoaded', () => {
        const fetchDirectElem = document.getElementById('fetchDirect');
        const updateElem = document.getElementById('update');
        const updateDirectElem = document.getElementById('updateDirect');
        const targetElem = document.getElementById('target');

        // Register listeners.
        fetchDirectElem.addEventListener('click', () => {
          window.__CORE__.modules.moduleA.fetch()
            .then((data) => {
              window.dispatchEvent(new CustomEvent('NAMESPACE:FETCHED', { detail: data }));
            })
            .catch((e) => {
              console.error(e);
            });
        });

        updateElem.addEventListener('click', () => {
          window.dispatchEvent(new Event('NAMESPACE:UPDATE'));
        });

        updateDirectElem.addEventListener('click', () => {
          window.__CORE__.modules.moduleB.update()
            .then((data) => {
              window.dispatchEvent(new CustomEvent('NAMESPACE:UPDATED', { detail: data }));
            })
            .catch((e) => {
              console.error(e);
            });
        });

        window.addEventListener('NAMESPACE:FETCHED', ({ detail: data }) => {
          targetElem.innerHTML = '';
          targetElem.innerHTML = JSON.stringify(data, null, 2);
        });

        window.addEventListener('NAMESPACE:UPDATED', ({ detail: data }) => {
          targetElem.innerHTML = '';
          targetElem.innerHTML = JSON.stringify(data, null, 2);
        });
      });
    </script>
  </body>
</html>
